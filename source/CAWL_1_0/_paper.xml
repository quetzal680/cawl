<?xml version="1.0" encoding="UTF-8"?>
<CAWL name="MTRoomService" version="1.0.1" targetNamespace="RobotServiceTest">
	<documentation>Meeting Room Services using LEGO Robots</documentation>
	<baseOntologies>
		<ontology namespace="http://ss.ssu.ac.kr/Ontology" location="file:/root/ontologies/Ontology/test.owl"/>
	</baseOntologies>

	<serviceProvider name="ssCom" type="Company" >
		<locator type="static"/>
	</serviceProvider>
	
	<message name="msg4MTRoomService">
		<part name="officeRoomNum" type="Room"/>	
	</message>
	
	<variable name="var4MTRoomService" type="msg4MTRoomService">
		<initialize part="officeRoomNum"><from expression="313"/></initialize> 
	</variable>	
		
	<activator name="DeliveryServiceActivator">
		<condition expression="C1">
			<context>
				<rule contribute="positive">
					<constraint name="C1">
						<subject type="Person">Tom</subject>
						<verb>locatedIn</verb>
						<object type="Room">Seoul</object>
					</constraint>
				</rule>
			</context>
		</condition>

		<activate flow="WarehouseFlow"/>
		<activate flow="LegoFlow"/>
	</activator>
	
	<flow name="LampFlow">
		<source>
		</source>

		<node name="TurnOnLamp">
			<condition expression="C1">
				<context>
					<rule contribute="positive">
						<constraint name="C1">
							<subject type="Person">Seoul</subject>
							<verb>hasAMPM</verb>
							<object type="AMPM">AM</object>
						</constraint>
					</rule>
				</context>
			</condition>

			<invoke serviceProvider="ssCom" portType="" operation="TurnOnLamp" input=""/>
		</node>

		<node name="TurnOffLamp">
			<condition expression="C1">
				<context>
					<rule contribute="positive">
						<constraint name="C1">
							<subject type="Person">Seoul</subject>
							<verb>hasAMPM</verb>
							<object type="AMPM">AM</object>
						</constraint>
					</rule>
				</context>
			</condition>

			<invoke serviceProvider="ssCom" portType="" operation="TurnOffLamp" input=""/>

			<synchronize>
				<nSync name="CloseDoor" />
			</synchronize>
		</node>

		<node name="OpenDoor">
			<condition expression="C1 and C2">
				<context>
					<rule contribute="positive">
						<constraint name="C1">
							<subject type="TemperatureSensor">VinylHouseTemperatureSensor</subject>
							<verb>hasTemperatureValue</verb>
							<object type="Temperature">30</object>
						</constraint>
					</rule>
				</context>
			</condition>

			<invoke serviceProvider="ssCom" portType="" operation="OpenDoor" input=""/>
		</node>

		<node name="CloseDoor">
			<condition expression="C1">
				<context>
					<rule contribute="positive">
						<constraint name="C1">
							<subject type="TemperatureSensor">VinylHouseTemperatureSensor</subject>
							<verb>hasTemperatureValue</verb>
							<object type="Temperature">20</object>
						</constraint>
					</rule>
				</context>
			</condition>

			<invoke serviceProvider="ssCom" portType="" operation="CloseDoor" input=""/>
		</node>

		<link from="source" to="TurnOnLamp"/>
		<link from="TurnOnLamp" to="TurnOffLamp"/>
		<link from="TurnOffLamp" to="sink" />

		<link from="source" to="OpenDoor"/>
		<link from="OpenDoor" to="CloseDoor"/>

		<sink>
		</sink>
	</flow>

	<flow name="LegoFlow">
		<source>
		</source>

		<node name="Go">
			<condition expression="C1">
				<context>
					<rule contribute="positive">
						<constraint name="C1">
							<subject type="Lego">DeliveryLego</subject>
							<verb>hasCommand</verb>
							<object type="Command">Go</object>
						</constraint>
					</rule>
				</context>
			</condition>

			<invoke serviceProvider="ssCom" portType="" operation="GoLego" input=""/>
		</node>

		<node name="Stop">
			<condition expression="C1">
				<context>
					<rule contribute="positive">
						<constraint name="C1">
							<subject type="Lego">DeliveryLego</subject>
							<verb>hasProduct</verb>
							<object type="Product">Can</object>
						</constraint>
					</rule>
				</context>
			</condition>

			<invoke serviceProvider="ssCom" portType="" operation="TurnOffVentilator" input=""/>
		</node>

		<node name="Back">
			<condition expression="C1">
				<context>
					<rule contribute="positive">
						<constraint name="C1">
							<subject type="HumiditySensor">VinylhouseHumiditySensor</subject>
							<verb>hasHumidity</verb>
							<object type="Humidity">30</object>
						</constraint>
					</rule>
				</context>
			</condition>

			<invoke serviceProvider="ssCom" portType="" operation="TurnOffVentilator" input=""/>
		</node>

		<link from="source" to="TurnOnVentilator"/>
		<link from="TurnOnVentilator" to="TurnOffVentilator"/>
		<link from="TurnOffVentilator" to="sink"/>

		<sink>
		</sink>
	</flow>


</CAWL>





